import Head from 'next/head'
import { Box } from '@chakra-ui/react'
import { useEffect } from 'react'
import { updateLogged } from '../src/actions'
import { useDispatch, useSelector } from 'react-redux'

export default function Home() {
  const dispatch = useDispatch()
  const logged = useSelector(state => state.Logged)

  function addDays(date, days) {
    var result = new Date(date);
    result.setDate(result.getDate() + days);
    return result;
  }

  useEffect(() => {
    const savedDateToken = localStorage.getItem('dateToken')

    let isLogged = false

    if (savedDateToken) {
      const dateToken = new Date(savedDateToken)
      const expireDate = addDays(dateToken, 7)
      const today = new Date()
      isLogged = today <= expireDate
    }

    dispatch(updateLogged(isLogged))

  }, [dispatch])

  function handleClick() {
    localStorage.removeItem('dateToken')
    localStorage.removeItem('token')
    dispatch(updateLogged(false))
  }

  return (
    <Box>
      <Head>
        <title>Contratos</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      {
        logged.logged ?
          <Box>
            logado
            <button onClick={handleClick}>teste</button>
          </Box> :
          <Box>
            n√£o logado
          </Box>
      }
    </Box>
  )
}
